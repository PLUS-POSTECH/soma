# Soma Build Pipeline
# Builds and tests on Windows and Linux
# Enforces code style using rustfmt

# Pipeline triggers on all code changes and PRs by default.
trigger:
  # Only queue build of latest change when other builds are not running.
  batch: true

resources:
  containers:
  - container: rust
    image: rust:latest

jobs:
- job: Code Style Check
  pool:
    vmImage: 'ubuntu-16.04'
  container: rust
  steps:
  - script: cargo fmt --all -- --check
    displayName: 'Check code style'

- job: Linux Build
  pool:
    vmImage: 'ubuntu-16.04'
  container: rust
  steps:
  - template: ci/rust-build.yml

- job: Windows Build
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - template: ci/rust-install.yml
  - template: ci/rust-build.yml
